package Starlink::PSF;

=head1 NAME

Starlink::PSF - helper class for mathematical operations on results
from the PSF command

=head1 SYNOPSIS

    $answer = Starlink::PSF-><useful_function($args)>;

=head1 DESCRIPTION

Provides methods for returning the results of operations involving
Sersic profiles, such as those generated by the Starlink application
PSF.

=head1 General Methods

=over 4

=item B<integrate_profile>

Calculate the integral of the profile, in either 1 or 2 dimensions.

The equation is (in LaTeX-speak):

 $\int_0^\infty r^{n} \exp[-0.5(r/\sigma)^\gamma] \,dr$

where n+1 is the dimension. In 2-dimensions (as currently implemented)
the 2*pi multiplier introduced by the integration over angle in polar
coordinates is included automatically to give the true area under the
curve.

The function is called with four parameters, e.g.,

    my $integral = integrate_profile( $a, $fwhm, $ratio, $gamma);

where $a is the amplitude, $fwhm is the Full-Width-at-Half-Maximum of
the minor axis, $ratio is the ratio of the major axis to the minor
axis in 2 dimensions, $gamma is the power-law as in the equation
above.

Note that the relationship between the dispersion, sigma (above), and
the FWHM is dependant on the value of gamma.

The user is responsible for ensuring the units are set correctly
before using the value of the integral.

The integrator uses the Gamma function implemented in Math::Gsl, and
makes use of the fastest method as documented in the Math::Gsl::Sf
module.

The solution for the integral is a standard result, in this case
obtained from CRC Standard Mathematical Tables and Formulae, by Daniel
Zwillinger.

=cut

sub integrate_profile {
  my $self = shift;

  my $PI = 3.1415926535;
  use Math::Gsl::Sf qw(:Gamma);

  my ($amp, $width, $axisr, $gamma) = @_;

  my $order = 1.0; #Exponent of r in eqn above
  my $k = ($order + 1.0) / $gamma;

  # Use geometric mean FWHM
  my $widthsq = $width * $axisr * $width;

  my $const = 2.0 * log(2.0)**$k ;

  my $integral = $PI * $amp * $widthsq * Math::Gsl::Sf::sf_gamma($k)
                      / ( $gamma * $const );

  return $integral;
}

=back

=head1 AUTHOR

Andy Gibb E<lt>agg@astro.ubc.caE<gt>

=head1 COPYRIGHT

Copyright (C) 2005 University of British Columbia. All Rights Reserved.

=cut

  1;
